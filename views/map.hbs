<nav class="navbar navbar-dark bg-dark">
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
          aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <form class="form-inline">
    <input class="form" type="search" placeholder="Search" id="address">
    <button type="button" id="malandro" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal">
      <img src="images/boton-superior-malandro-2.png" width="135" height="135" alt="" value="save">
    </button>
  </form>
</nav>

<div id="map"></div>
<footer>
  <nav class="footer-nav">
    <a class="iconimages" href="#">
      <img src="images/icono-robo.png" width="140" height="140" alt="">
    </a>
    <a class="iconimages" href="#">
      <img src="images/icono-acoso-sexual.png" width="140" height="140" alt="">
    </a>
    <a class="iconimages" href="#">
      <img src="images/icono-grupos-sospechosos.png" width="140" height="140" alt="">
    </a>
    <a class="iconimages" href="#">
      <img src="images/icono-enfrentamientos-armados.png" width="140" height="140" alt="">
    </a>
    <a class="iconimages" href="#">
      <img src="images/icono-sin-luz.png" width="140" height="140" alt="">
    </a>
    <a class="iconimages" href="#">
      <img src="images/icono-agresion.png" width="140" height="140" alt="">
    </a>
  </nav>
</footer>


<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Este lugar, Está Malandro</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form action="/map" method="post">
          <div class="form-group">
            <select name="tipodelugar" id="tipodelugar" class="form-control">
              <option selected>Tipo de Incidente</option>
              <option value="Robo">Robo</option>
              <option value="Acoso Sexual">Acoso Sexual</option>
              <option value="Grupos Sospechosos">Grupos Sospechosos</option>
              <option value="Enfrentamientos Armados">Enfrentamientos Armados</option>
              <option value="Sin Iluminación">Sin Iluminación</option>
              <option value="Agresión">Agresión</option>
            </select>
          </div> 
          <div class="form-group row">
            <div class="col-sm-12">
              <input type="text" class="form-control" id="direccion" placeholder="Dirección" name="location[address]">
            </div>  
            </form>
          </div>
        <div class="form-group row">
          <div class="col-sm-12">
            <textarea type="text" class="form-control" id="comentario" placeholder="Comentario" name="comentario"></textarea>
          </div>  
          </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
        <button type="submit" class="btn btn-primary">Reportar</button>
      </div>
    </div>
  </div>
</div>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAGQ8r0BfjX69HJHYdnGnoZ5K1m9YwjcQo&libraries=places"></script>
<script>

  /* New Dot */

  const direccion = document.getElementById('direccion');
  const search = document.getElementById('address');
  const lupita = document.getElementById('lupita');
  const image = {
    url:'images/marcador-malandro-rojo-small.png',
    size: new google.maps.Size(59, 80)
  };

  console.log(search);
  var options = {
    componentRestrictions: {country: 'mx'}
  };
  function autoComplete(input) {
    const dropdown = new google.maps.places.Autocomplete(input, options);
    dropdown.addListener('place_changed', () => {
      const place = dropdown.getPlace()
      console.log(place.geometry.location.lat())
      nuevaDireccion(place)
    });

  }

  function nuevaDireccion (place){

    const lugar = place;
    const center = {
      lat: lugar.geometry.location.lat(),
      lng: lugar.geometry.location.lng()
    };
    const map = new google.maps.Map(
      document.getElementById('map'),
      {
        zoom: 15,
        center: center
      }
    )
    const myMarker = new google.maps.Marker({
      position: center,
      map: map,
      title: "I'm here",
      animation: google.maps.Animation.BOUNCE,
      icon: image
    });
  }

    malandro.addEventListener('click',autoComplete(search));

  function startMap() {

    if (navigator.geolocation) {
      // Get current position
      // The permissions dialog will popup
      navigator.geolocation.getCurrentPosition(function (position) {
        const center = {
          lat: position.coords.latitude,
          lng: position.coords.longitude
        };
        // Create an object to match
        // google's Lat-Lng object format
        const map = new google.maps.Map(
          document.getElementById('map'),
          {
            center,
            zoom: 20
          }
        );


        const myMarker = new google.maps.Marker({
          position: center,
          map: map,
          title: "I'm here",
          animation: google.maps.Animation.BOUNCE,
          icon: image
        });

        // User granted permission
        // Center the map in the position we got
      }, function () {
        // If something else goes wrong
        console.log('Error in the geolocation service.');
      });
    } else {
      // Browser says: Nah! I do not support this.
      console.log('Browser does not support geolocation.');
    }
  }

  startMap();

</script>
